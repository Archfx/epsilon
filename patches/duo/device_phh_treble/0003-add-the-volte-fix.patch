From 8aacf50abb6f03b530b30eb33477a5bad945867a Mon Sep 17 00:00:00 2001
From: Archfx <cybx@live.com>
Date: Sat, 16 Nov 2024 14:29:03 -0500
Subject: [PATCH] add the volte-fix patch

---
 aosp.mk        | 2 +-
 base.mk        | 5 +++++
 phh-on-data.sh | 9 ++++++++-
 3 files changed, 14 insertions(+), 2 deletions(-)

diff --git a/aosp.mk b/aosp.mk
index 093dba0..c34d6c1 100644
--- a/aosp.mk
+++ b/aosp.mk
@@ -1,4 +1,4 @@
 $(call inherit-product, vendor/ponces/config/common.mk)
 
 PRODUCT_SYSTEM_DEFAULT_PROPERTIES += \
-    ro.system.ota.json_url=https://raw.githubusercontent.com/Archfx/duo-de/main-14/config/ota.json
+    ro.system.ota.json_url=https://raw.githubusercontent.com/Archfx/duo-de/main-15/config/ota.json
diff --git a/base.mk b/base.mk
index f4d5963..35a1b79 100644
--- a/base.mk
+++ b/base.mk
@@ -199,6 +199,11 @@ PRODUCT_COPY_FILES += \
 PRODUCT_COPY_FILES += \
 	vendor/surface/privapp-permissions-duo.xml:system/system_ext/etc/permissions/privapp-permissions-com.thain.duo.xml
 
+# Privapp-permissions for volte-fix
+PRODUCT_COPY_FILES += \
+	volte-fix/xmls/*:/system/etc/permissions/ \
+	volte-fix/64bit/ims:/system/priv-app/
+
 # Remote debugging
 PRODUCT_COPY_FILES += \
 	device/phh/treble/remote/dbclient:system/bin/dbclient \
diff --git a/phh-on-data.sh b/phh-on-data.sh
index f36b15e..f33a051 100644
--- a/phh-on-data.sh
+++ b/phh-on-data.sh
@@ -42,4 +42,11 @@ fi
 
 if [ "$(getprop  persist.sys.thain.duo.app_hinting)" -eq 1 ]; then
     setprop vendor.thain.app_hinting 1
-fi
\ No newline at end of file
+fi
+
+# Enable IMS using VoLTE
+setprop persist.dbg.allow_ims_off 1
+setprop persist.dbg.volte_avail_ovr 1
+setprop persist.dbg.vt_avail_ovr 1
+setprop persist.dbg.wfc_avail_ovr 1
+setprop persist.sys.phh.ims.caf true
\ No newline at end of file
-- 
2.34.1

